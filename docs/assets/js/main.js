"use strict";const searchBtn=document.querySelector(".js-search-button"),logBtnContainer=document.querySelector(".js-logBtnContainer"),searchInput=document.querySelector(".js-search-input"),favoriteListSection=document.querySelector(".js-favoriteShows-section"),searchSection=document.querySelector(".js-search-section"),containerDeleteAllBtn=document.querySelector(".js-deleteAllBtnContainer"),form=document.querySelector(".js-form");let logBtn="",searchedShows=[],favoriteShows=[],shows=[],cardShows=[],favCardShows=[],xDeleteFav=[];function getSearchedInfo(e){e.preventDefault(),fetch("https://api.tvmaze.com/search/shows?q="+searchInput.value).then(e=>e.json()).then(e=>{searchedShows=e;for(let e=0;e<searchedShows.length;e++){let t="";t=null===searchedShows[e].show.image?"https://via.placeholder.com/210x295/ebcd80/666666/?text=TV":searchedShows[e].show.image.medium,shows[e]={idShow:searchedShows[e].show.id,imgShow:t,titleShow:searchedShows[e].show.name,language:searchedShows[e].show.language}}paintShows()})}function paintShows(){let e="";const t=["English","Spanish","Portuguese"];for(let o=0;o<shows.length;o++){const a=shows[o].idShow;let s=favoriteShows.map(e=>e.idShow).indexOf(a),n="";n=t.includes(shows[o].language)?'<i class="far fa-thumbs-up recomend" title="You undestand it!!"></i>':`<i class="fas fa-exclamation-triangle caution" title="Aware: language is ${shows[o].language}"></i>`;let i="";-1!==s&&(i="cardShow-selected"),e+=`<div class="cardShow js-cardShow ${i}" data-id="${shows[o].idShow}">`,e+=`<img src="${shows[o].imgShow}" alt="Portada de ${shows[o].titleShow}" />`,e+=`<h2>${shows[o].titleShow}</h2>`,e+=`<span class="language-container"><i class="fas fa-language language" title="${shows[o].language}"></i>${n}</span>`,e+="</div>"}searchSection.innerHTML=e,listenCardShowsClicks()}function addToFavorite(e){e.currentTarget.classList.toggle("cardShow-selected");for(let e=0;e<shows.length;e++){const t=parseInt(cardShows[e].dataset.id);let o=shows.map(e=>e.idShow).indexOf(t),a=favoriteShows.map(e=>e.idShow).indexOf(t);cardShows[e].classList.contains("cardShow-selected")?-1===a&&favoriteShows.push(shows[o]):-1!==a&&favoriteShows.splice(a,1)}paintFavoriteShows(),storeFavorites()}function paintFavoriteShows(){let e="";for(let t=0;t<favoriteShows.length;t++)e+=`<li><div class="favorite-cardShow js-favCardShow" data-id="${favoriteShows[t].idShow}">`,e+=`<div class="container-favleft"><img src="${favoriteShows[t].imgShow}" alt="Portada de ${favoriteShows[t].titleShow}" />`,e+=`<h3>${favoriteShows[t].titleShow}</h3></div>`,e+=`<div class="container-favright"><i class="fas fa-star star"></i><span class="delete-favorite js-deleteFav" data-id="${favoriteShows[t].idShow}">X</span></div>`,e+="</div></li>";favoriteListSection.innerHTML=`<ul>${e}</ul>`,listenXClicks(),favoriteShows.length>0&&""===logBtnContainer.innerHTML?createLogBtn():0===xDeleteFav.length&&(logBtnContainer.innerHTML=""),favoriteShows.length>0&&""===containerDeleteAllBtn.innerHTML?createDeleteBtn():0===xDeleteFav.length&&(containerDeleteAllBtn.innerHTML="")}function listenCardShowsClicks(){cardShows=document.querySelectorAll(".js-cardShow");for(let e=0;e<shows.length;e++)cardShows[e].addEventListener("click",addToFavorite)}function createLogBtn(){logBtnContainer.innerHTML='<button id="favorite-button" class="favorite-button js-favorite-button" type="button">Log</button>',logBtn=document.querySelector(".js-favorite-button"),logBtn.addEventListener("click",countFavorites)}function countFavorites(){alert(`Tienes ${favoriteShows.length} series favoritas en tu lista.`)}function storeFavorites(){localStorage.setItem("favoriteList",JSON.stringify(favoriteShows))}function getFromLocalStorage(){const e=localStorage.getItem("favoriteList"),t=JSON.parse(e);null!==e&&(favoriteShows=t,paintFavoriteShows())}function createDeleteBtn(){containerDeleteAllBtn.innerHTML='<button id="delete-fav-button" class="delete-fav-button js-deleteAllFav" type="button">Clear</button>';document.querySelector(".js-deleteAllFav").addEventListener("click",clearAllFavorites)}function clearAllFavorites(){for(let e=0;e<cardShows.length;e++)cardShows[e].classList.remove("cardShow-selected");favoriteListSection.innerHTML="",containerDeleteAllBtn.innerHTML="",favoriteShows.splice(0,favoriteShows.length),localStorage.removeItem("favoriteList")}function clearOneFav(e){const t=parseInt(e.currentTarget.dataset.id);let o=shows.map(e=>e.idShow).indexOf(t),a=favoriteShows.map(e=>e.idShow).indexOf(t);-1!==a&&(favoriteShows.splice(a,1),cardShows[o]&&cardShows[o].classList.remove("cardShow-selected"),storeFavorites(),paintFavoriteShows())}function listenXClicks(){xDeleteFav=document.querySelectorAll(".js-deleteFav");for(let e=0;e<xDeleteFav.length;e++)xDeleteFav[e].addEventListener("click",clearOneFav)}getFromLocalStorage(),searchBtn.addEventListener("click",getSearchedInfo),form.addEventListener("submit",getSearchedInfo);