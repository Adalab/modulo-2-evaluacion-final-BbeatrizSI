"use strict";const searchBtn=document.querySelector(".js-search-button"),searchInput=document.querySelector(".js-search-input"),favoriteListSection=document.querySelector(".js-favoriteShows-section"),searchSection=document.querySelector(".js-search-section"),containerDeleteAllBtn=document.querySelector(".js-deleteAllBtnContainer");let searchedShows=[],favoriteShows=[],shows=[],cardShows=[],favCardShows=[],xDeleteFav=[];function getSearchedInfo(){fetch("http://api.tvmaze.com/search/shows?q="+searchInput.value).then(e=>e.json()).then(e=>{searchedShows=e;for(let e=0;e<searchedShows.length;e++){let t="";t=null===searchedShows[e].show.image?"https://via.placeholder.com/210x295/ebcd80/666666/?text=TV":searchedShows[e].show.image.medium,shows[e]={idShow:searchedShows[e].show.id,imgShow:t,titleShow:searchedShows[e].show.name}}paintShows()})}function paintShows(){let e="";for(let t=0;t<shows.length;t++){const o=shows[t].idShow;-1!==favoriteShows.map(e=>e.idShow).indexOf(o)?(e+=`<div class="cardShow js-cardShow cardShow-selected" data-id="${shows[t].idShow}">`,e+=`<img src="${shows[t].imgShow}" alt="Portada de ${shows[t].titleShow}" />`,e+=`<h2>${shows[t].titleShow}</h2>`,e+="</div>"):(e+=`<div class="cardShow js-cardShow" data-id="${shows[t].idShow}">`,e+=`<img src="${shows[t].imgShow}" alt="Portada de ${shows[t].titleShow}" />`,e+=`<h2>${shows[t].titleShow}</h2>`,e+="</div>")}searchSection.innerHTML=e,listenCardShowsClicks(),createNextPrev()}function addToFavorite(e){e.currentTarget.classList.toggle("cardShow-selected");for(let e=0;e<shows.length;e++){const t=parseInt(cardShows[e].dataset.id);let o=shows.map(e=>e.idShow).indexOf(t),s=favoriteShows.map(e=>e.idShow).indexOf(t);cardShows[e].classList.contains("cardShow-selected")?-1===s&&favoriteShows.push(shows[o]):-1!==s&&favoriteShows.splice(s,1)}paintFavoriteShows(),storeFavorites()}function paintFavoriteShows(){let e="";for(let t=0;t<favoriteShows.length;t++)e+=`<li><div class="favorite-cardShow js-favCardShow" data-id="${favoriteShows[t].idShow}">`,e+=`<div class="container-favleft"><img src="${favoriteShows[t].imgShow}" alt="Portada de ${favoriteShows[t].titleShow}" />`,e+=`<h3>${favoriteShows[t].titleShow}</h3></div>`,e+=`<span class="delete-favorite js-deleteFav" data-id="${favoriteShows[t].idShow}">X</span>`,e+="</div></li>";favoriteListSection.innerHTML=e,listenXClicks(),favoriteShows.length>0&&""===containerDeleteAllBtn.innerHTML?createDeleteBtn():0===xDeleteFav.length&&(containerDeleteAllBtn.innerHTML="")}function listenCardShowsClicks(){cardShows=document.querySelectorAll(".js-cardShow");for(let e=0;e<shows.length;e++)cardShows[e].addEventListener("click",addToFavorite)}function storeFavorites(){localStorage.setItem("favoriteList",JSON.stringify(favoriteShows))}function getFromLocalStorage(){const e=localStorage.getItem("favoriteList"),t=JSON.parse(e);null!==e&&(favoriteShows=t,paintFavoriteShows())}function createDeleteBtn(){containerDeleteAllBtn.innerHTML='<button id="delete-fav-button" class="delete-fav-button js-deleteAllFav" type="button">Clear</button>';document.querySelector(".js-deleteAllFav").addEventListener("click",clearAllFavorites)}function clearAllFavorites(){for(let e=0;e<cardShows.length;e++)cardShows[e].classList.remove("cardShow-selected");favoriteListSection.innerHTML="",containerDeleteAllBtn.innerHTML="",favoriteShows.splice(0,favoriteShows.length),localStorage.removeItem("favoriteList")}function clearOneFav(e){const t=parseInt(e.currentTarget.dataset.id);let o=shows.map(e=>e.idShow).indexOf(t),s=favoriteShows.map(e=>e.idShow).indexOf(t);-1!==s&&(favoriteShows.splice(s,1),cardShows[o]&&cardShows[o].classList.remove("cardShow-selected"),storeFavorites(),paintFavoriteShows())}function listenXClicks(){xDeleteFav=document.querySelectorAll(".js-deleteFav");for(let e=0;e<xDeleteFav.length;e++)xDeleteFav[e].addEventListener("click",clearOneFav)}getFromLocalStorage(),searchBtn.addEventListener("click",getSearchedInfo);